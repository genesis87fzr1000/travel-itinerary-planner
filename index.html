<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…ç¨‹ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ (v4.0 Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .nav-button.active { background-color: #4f46e5; color: white; border-bottom: 4px solid #6366f1; }
        .nav-button:not(.active) { background-color: #f9fafb; color: #1f2937; }
        .shiori-row { display: flex; align-items: flex-start; padding: 12px 0; border-bottom: 1px solid #e5e7eb; }
        .shiori-num { flex-shrink: 0; width: 50px; font-weight: 800; color: #4f46e5; }
        .shiori-content { flex-grow: 1; font-weight: 600; color: #1f2937; }
    </style>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOStiNglNEGEnPnhDxJG0RSQqgJXVtUQw&libraries=places,geometry&callback=initMap" async defer></script>
</head>
<body class="bg-gray-100 min-h-screen p-2 sm:p-6 text-gray-800">

    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
        <header class="p-6 bg-indigo-700 text-white shadow-xl flex justify-between items-center">
            <h1 class="text-2xl sm:text-3xl font-extrabold flex items-center gap-2">
                <span>ğŸ—ºï¸</span> æ—…ç¨‹ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ <span class="text-xs bg-indigo-500 px-2 py-1 rounded-full">v4.0</span>
            </h1>
            <button onclick="clearData()" class="text-xs text-indigo-200 hover:text-white underline">ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
        </header>

        <nav class="flex border-b border-gray-200 bg-gray-50 text-sm sm:text-base">
            <button onclick="navigate('input')" id="nav-input" class="nav-button flex-1 py-4 font-bold transition-colors">1. åœ°ç‚¹ãƒ»åŸºç‚¹</button>
            <button onclick="navigate('selection')" id="nav-selection" class="nav-button flex-1 py-4 font-bold transition-colors">2. ãƒ«ãƒ¼ãƒˆé¸æŠ</button>
            <button onclick="navigate('shiori')" id="nav-shiori" class="nav-button flex-1 py-4 font-bold transition-colors">3. æ—…ã®ã—ãŠã‚Š</button>
        </nav>

        <main id="app-content" class="p-4 sm:p-8 min-h-[500px]">
            <div class="text-center p-10 text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</div>
        </main>

        <div id="message-container" class="fixed bottom-4 right-4 z-50 w-full max-w-sm px-4"></div>
    </div>
    <datalist id="saved-locations-list"></datalist>

    <script>
        // --- 0. åˆæœŸåŒ– ---
        function initMap() { console.log("Maps API Loaded"); }
        const APP_VERSION = '4.0';

        // --- 1. ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
        const generateDefaultItinerary = () => ({
            version: APP_VERSION,
            planName: "æ–°è¦æ—…ç¨‹ãƒ—ãƒ©ãƒ³ " + new Date().toLocaleDateString('ja-JP'),
            baseDateTime: new Date().toISOString().substring(0, 16),
            roundingMinutes: 0,
            gatheringMinutes: 10,
            stops: [
                { id: 's1', location: 'æ±äº¬é§…', isBaseTime: true, stayMinutes: 0, stayReason: '', memo: '' },
                { id: 's2', location: 'æ¸‹è°·é§…', isBaseTime: false, stayMinutes: 15, stayReason: 'å¾…åˆã›', memo: '' },
                { id: 's3', location: 'æ¨ªæµœé§…', isBaseTime: false, stayMinutes: 0, stayReason: '', memo: '' }
            ],
            segments: [],
            currentPage: 'input'
        });

        let itinerary = JSON.parse(localStorage.getItem('itineraryState')) || generateDefaultItinerary();
        if(itinerary.version !== APP_VERSION) itinerary = generateDefaultItinerary(); // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ãªã‚‰ãƒªã‚»ãƒƒãƒˆ
        
        let savedLocations = JSON.parse(localStorage.getItem('savedLocations')) || [];
        let mapInstances = {}; // ãƒãƒƒãƒ—ä¿æŒç”¨

        function saveState() {
            localStorage.setItem('itineraryState', JSON.stringify(itinerary));
            localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
            updateDatalist();
        }

        // --- 2. è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
        function addMinutesToISO(iso, min) {
            const d = new Date(iso); d.setMinutes(d.getMinutes() + min);
            const tz = d.getTimezoneOffset() * 60000; return (new Date(d - tz)).toISOString().slice(0, 16);
        }
        function formatTime(iso) { 
            if(!iso) return "--:--";
            const d = new Date(iso); 
            return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
        }
        function getModeLabel(m) { const l={'DRIVING':'è»Š','WALKING':'å¾’æ­©','BICYCLING':'è‡ªè»¢è»Š','TRANSIT':'é›»è»Š'}; return l[m]||'è»Š'; }

        // --- 3. Google API é€£æº ---
        function validateLocation(id) {
            const stop = itinerary.stops.find(s=>s.id===id);
            if(!stop.location) return showAlert('ç©ºæ¬„ã§ã™','error');
            showAlert('æ¤œè¨¼ä¸­...', 'info');
            new google.maps.places.AutocompleteService().getPlacePredictions({ input: stop.location }, (preds, status) => {
                if (status === 'OK' && preds.length > 0) {
                    stop.location = preds[0].description;
                    saveState(); renderInputPage();
                    showAlert(`OK: ${stop.location}`, 'success');
                } else {
                    showAlert('è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                }
            });
        }

        // å®Ÿéš›ã®ãƒ«ãƒ¼ãƒˆã‚’å–å¾—ã—ã¦ä¿å­˜ã™ã‚‹
        async function fetchRealRoutes(index) {
            const seg = itinerary.segments[index];
            const start = itinerary.stops[index].location;
            const end = itinerary.stops[index+1].location;
            const mode = seg.travelMode || 'DRIVING';

            return new Promise((resolve) => {
                new google.maps.DirectionsService().route({
                    origin: start, destination: end, travelMode: mode, provideRouteAlternatives: true
                }, (res, status) => {
                    if (status === 'OK') {
                        seg.mockRoutes = res.routes.slice(0,3).map((r, i) => ({
                            id: `r-${index}-${i}`,
                            label: `ãƒ«ãƒ¼ãƒˆ ${i+1}`,
                            durationMinutes: Math.ceil(r.legs[0].duration.value / 60),
                            desc: r.summary,
                            tolls: (mode==='DRIVING' && r.summary.includes('æœ‰æ–™')) ? [{standard:1000, kei:700}] : []
                        }));
                        if(!seg.selectedRoute) seg.selectedRoute = seg.mockRoutes[0].id;
                        resolve(true);
                    } else {
                        seg.mockRoutes = [];
                        resolve(false);
                    }
                });
            });
        }

        // --- 4. ç”»é¢é·ç§» ---
        function navigate(page) {
            itinerary.currentPage = page;
            document.querySelectorAll('.nav-button').forEach(b => {
                b.classList.remove('active');
                if(b.id === `nav-${page}`) b.classList.add('active');
            });
            
            const content = document.getElementById('app-content');
            if(page === 'input') renderInputPage();
            else if(page === 'selection') renderSelectionPage();
            else if(page === 'shiori') renderSummaryPage();
            saveState();
        }

        // --- 5. æç”»é–¢æ•° ---

        // â–  1. å…¥åŠ›ç”»é¢
        function renderInputPage() {
            // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒæœŸ
            while(itinerary.segments.length < itinerary.stops.length - 1) itinerary.segments.push({ travelMode: 'DRIVING', mockRoutes: [], selectedRoute: null });
            
            // é›†åˆæ™‚é–“ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (5åˆ†ã€œ60åˆ†)
            const gatherOpts = [5,10,15,20,30,40,50,60].map(m => `<option value="${m}" ${itinerary.gatheringMinutes===m?'selected':''}>${m}åˆ†å‰</option>`).join('');

            let h = `
                <div class="space-y-6 animate-fade-in">
                    <div class="p-4 bg-indigo-50 rounded-xl grid grid-cols-1 md:grid-cols-3 gap-4 border border-indigo-100">
                        <div><label class="text-xs font-bold text-gray-500">åŸºç‚¹æ—¥æ™‚</label><input type="datetime-local" value="${itinerary.baseDateTime}" onchange="itinerary.baseDateTime=this.value; saveState();" class="w-full p-2 border rounded font-bold"></div>
                        <div><label class="text-xs font-bold text-gray-500">ä¸¸ã‚è¨­å®š</label><select onchange="itinerary.roundingMinutes=parseInt(this.value); saveState();" class="w-full p-2 border rounded font-bold"><option value="0">ãªã—</option><option value="5">5åˆ†</option><option value="10">10åˆ†</option></select></div>
                        <div><label class="text-xs font-bold text-gray-500">é›†åˆæ™‚é–“</label><select onchange="itinerary.gatheringMinutes=parseInt(this.value); saveState();" class="w-full p-2 border rounded font-bold">${gatherOpts}</select></div>
                    </div>
                    <div class="space-y-4">`;

            itinerary.stops.forEach((s, i) => {
                const isLast = i === itinerary.stops.length - 1;
                h += `
                    <div class="bg-white p-5 rounded-xl border ${s.isBaseTime ? 'border-green-500 ring-2 ring-green-50' : 'border-gray-200'} shadow-sm">
                        <div class="flex justify-between mb-2">
                            <span class="font-bold text-lg text-gray-700">${i+1}. ${i===0?'å‡ºç™º':isLast?'åˆ°ç€':'çµŒç”±'} ${s.isBaseTime?'<span class="text-xs bg-green-100 text-green-700 px-2 rounded">åŸºç‚¹</span>':''}</span>
                            ${(i>0 && !isLast) ? `<button onclick="removeStop(${i})" class="text-red-500 text-sm">å‰Šé™¤</button>`:''}
                        </div>
                        <div class="flex gap-2 mb-3">
                            <input class="flex-1 p-2 border rounded font-bold" value="${s.location}" list="saved-locations-list" onchange="itinerary.stops[${i}].location=this.value; saveState();" placeholder="åœ°ç‚¹å">
                            <button onclick="validateLocation('${s.id}')" class="bg-indigo-100 text-indigo-700 px-3 rounded font-bold">ğŸ” æ¤œè¨¼</button>
                            <button onclick="saveLoc('${s.id}')" class="bg-gray-100 px-3 rounded">ğŸ’¾</button>
                        </div>
                        ${(i>0 && !isLast) ? `
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <div><label class="text-xs text-gray-400">æ»åœ¨(åˆ†)</label><input type="number" value="${s.stayMinutes}" onchange="itinerary.stops[${i}].stayMinutes=parseInt(this.value); saveState();" class="w-full p-2 border rounded text-center"></div>
                            <div><label class="text-xs text-gray-400">ç†ç”±</label><input type="text" value="${s.stayReason}" onchange="itinerary.stops[${i}].stayReason=this.value; saveState();" class="w-full p-2 border rounded"></div>
                        </div>` : ''}
                        <div class="mb-3"><label class="text-xs text-gray-400">ãƒ¡ãƒ¢</label><input class="w-full p-2 border rounded bg-yellow-50" value="${s.memo}" onchange="itinerary.stops[${i}].memo=this.value; saveState();"></div>
                        <label class="text-sm"><input type="radio" name="base" ${s.isBaseTime?'checked':''} onchange="setBase(${i})"> ã“ã“ã‚’æ™‚é–“ã®åŸºç‚¹ã«ã™ã‚‹</label>
                        
                        ${!isLast ? `
                        <div class="mt-3 pt-3 border-t border-gray-100">
                            <p class="text-xs text-center text-gray-400 mb-1">â–¼ æ¬¡ã®ç§»å‹•æ‰‹æ®µ â–¼</p>
                            <div class="flex justify-center gap-1">
                                ${['DRIVING','WALKING','BICYCLING'].map(m => `
                                    <button onclick="changeMode(${i}, '${m}')" class="px-3 py-1 text-sm rounded border ${itinerary.segments[i]?.travelMode===m?'bg-indigo-600 text-white':'bg-white text-gray-500'}">${getModeLabel(m)}</button>
                                `).join('')}
                            </div>
                        </div>` : ''}
                    </div>`;
            });

            h += `</div>
                  <button onclick="addStop()" class="w-full py-3 border-2 border-dashed border-gray-300 text-gray-500 font-bold rounded-xl hover:text-indigo-500">+ åœ°ç‚¹ã‚’è¿½åŠ </button>
                  <div class="h-6"></div>
                  <button onclick="goToSelection()" class="w-full py-4 bg-indigo-600 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-indigo-700 transition">æ¬¡ã¸ï¼šãƒ«ãƒ¼ãƒˆè¨ˆç®— ğŸš€</button>
                </div>`;
            document.getElementById('app-content').innerHTML = h;
        }

        // â–  2. ãƒ«ãƒ¼ãƒˆé¸æŠç”»é¢ (å…¨åŒºé–“è¡¨ç¤º)
        async function renderSelectionPage() {
            const el = document.getElementById('app-content');
            el.innerHTML = '<div class="text-center p-10">ãƒ«ãƒ¼ãƒˆæƒ…å ±ã‚’å–å¾—ä¸­...<br>Google Maps APIã¨é€šä¿¡ã—ã¦ã„ã¾ã™</div>';

            // å…¨åŒºé–“ã®ãƒ«ãƒ¼ãƒˆã‚’æœ€æ–°åŒ–
            for(let i=0; i<itinerary.segments.length; i++) {
                if(itinerary.stops[i].location && itinerary.stops[i+1].location) {
                    await fetchRealRoutes(i);
                }
            }
            saveState();

            let h = `<h2 class="text-xl font-bold mb-4 text-indigo-700">2. ãƒ«ãƒ¼ãƒˆé¸æŠ</h2><div class="space-y-8">`;
            
            itinerary.segments.forEach((seg, i) => {
                if(!seg.mockRoutes || seg.mockRoutes.length === 0) return;
                
                h += `<div class="bg-white p-4 rounded-xl shadow-md border border-gray-200">
                        <h3 class="font-bold text-gray-700 mb-2">åŒºé–“ ${i+1}: ${itinerary.stops[i].location} â†’ ${itinerary.stops[i+1].location} (${getModeLabel(seg.travelMode)})</h3>
                        <div class="space-y-2 mb-4">`;
                
                seg.mockRoutes.forEach(r => {
                    const isSel = r.id === seg.selectedRoute;
                    h += `<div onclick="selectRoute(${i}, '${r.id}')" class="p-3 border rounded cursor-pointer flex justify-between items-center ${isSel ? 'bg-indigo-50 border-indigo-500 ring-1 ring-indigo-500' : 'hover:bg-gray-50'}">
                            <div><div class="font-bold">${r.label} (${r.desc})</div><div class="text-sm text-gray-500">${r.durationMinutes}åˆ† / ${r.tolls.length>0?'æœ‰æ–™':'ç„¡æ–™'}</div></div>
                            ${isSel ? '<span class="text-indigo-600 font-bold">âœ“</span>' : ''}
                          </div>`;
                });
                
                h += `</div>
                      <div id="map-area-${i}" class="w-full h-64 bg-gray-100 rounded border"></div>
                      </div>`;
            });

            h += `</div>
                  <div class="mt-8 flex justify-between">
                    <button onclick="navigate('input')" class="px-6 py-3 bg-gray-300 rounded font-bold">æˆ»ã‚‹</button>
                    <button onclick="navigate('shiori')" class="px-6 py-3 bg-green-600 text-white rounded font-bold shadow-lg">æ¬¡ã¸ï¼šã—ãŠã‚Šä½œæˆ âœ¨</button>
                  </div>`;
            
            el.innerHTML = h;

            // HTMLæç”»å¾Œã«åœ°å›³ã‚’æç”»
            itinerary.segments.forEach((seg, i) => {
                if(seg.mockRoutes.length > 0) drawMap(i, seg.selectedRoute);
            });
        }

        // â–  3. ã—ãŠã‚Šç”»é¢
        function renderSummaryPage() {
            // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨ˆç®—
            const baseIdx = itinerary.stops.findIndex(s=>s.isBaseTime);
            if(baseIdx === -1) return showAlert('åŸºç‚¹è¨­å®šãŒã‚ã‚Šã¾ã›ã‚“','error');

            // Forward
            let time = itinerary.baseDateTime;
            for(let i=baseIdx; i<itinerary.stops.length; i++){
                const s = itinerary.stops[i]; s.arrivalTime = time;
                s.departureTime = addMinutesToISO(s.arrivalTime, s.stayMinutes);
                if(i < itinerary.segments.length) {
                    const seg = itinerary.segments[i];
                    const r = seg.mockRoutes.find(x=>x.id===seg.selectedRoute) || {durationMinutes:30};
                    time = addMinutesToISO(s.departureTime, r.durationMinutes);
                }
            }
            // Backward
            time = itinerary.stops[baseIdx].arrivalTime;
            for(let i=baseIdx-1; i>=0; i--){
                const seg = itinerary.segments[i];
                const r = seg.mockRoutes.find(x=>x.id===seg.selectedRoute) || {durationMinutes:30};
                const sNext = itinerary.stops[i+1];
                itinerary.stops[i].departureTime = addMinutesToISO(sNext.arrivalTime, -r.durationMinutes);
                itinerary.stops[i].arrivalTime = addMinutesToISO(itinerary.stops[i].departureTime, -itinerary.stops[i].stayMinutes);
            }

            // ãƒªã‚¹ãƒˆç”Ÿæˆ
            let list = []; let c=1;
            itinerary.stops.forEach((s, i) => {
                const isLast = i===itinerary.stops.length-1;
                if(i===0) {
                    list.push({idx:c++, t:`${s.location}ã€€${formatTime(addMinutesToISO(s.departureTime, -itinerary.gatheringMinutes))}ã€€é›†åˆ`});
                    list.push({idx:c++, t:`${s.location}ã€€${formatTime(s.departureTime)}ã€€å‡ºç™º`});
                } else {
                    list.push({idx:c++, t:`${s.location}ã€€${formatTime(s.arrivalTime)}ã€€åˆ°ç€`});
                    if(!isLast) {
                        list.push({idx:c++, t:`${s.location}ã€€${s.stayReason}ã€€(æ»åœ¨${s.stayMinutes}åˆ†) ${s.memo}`});
                        list.push({idx:c++, t:`${s.location}ã€€${formatTime(s.departureTime)}ã€€å‡ºç™º`});
                    }
                }
                if(!isLast) {
                    const seg = itinerary.segments[i];
                    const r = seg.mockRoutes.find(x=>x.id===seg.selectedRoute);
                    if(r) list.push({idx:c++, t:`${getModeLabel(seg.travelMode)}ç§»å‹•ã€€${r.durationMinutes}åˆ†ã€€${r.tolls.length>0?'æœ‰æ–™':''}`});
                }
            });

            const rows = list.map(e => `<div class="shiori-row"><div class="shiori-num">${e.idx.toString().padStart(2,'0')}.</div><div class="shiori-content">${e.t}</div></div>`).join('');
            
            document.getElementById('app-content').innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-lg max-w-3xl mx-auto">
                    <h2 class="text-2xl font-bold text-center text-indigo-900 mb-6">${itinerary.planName}</h2>
                    <div class="font-mono">${rows}</div>
                </div>
                <div class="mt-6 text-center"><button onclick="navigate('input')" class="bg-gray-500 text-white px-6 py-2 rounded">ä¿®æ­£</button> <button onclick="window.print()" class="bg-indigo-600 text-white px-6 py-2 rounded">å°åˆ·</button></div>
            `;
        }


        // --- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ---
        // åœ°å›³æç”»ã®ä¿®æ­£ç‰ˆï¼šå†æç”»æ™‚ã«å¿…ãšæ–°è¦ä½œæˆã™ã‚‹
        function drawMap(index, routeId) {
            const div = document.getElementById(`map-area-${index}`);
            if(!div) return;
            div.innerHTML = ''; // ã‚¯ãƒªã‚¢

            const seg = itinerary.segments[index];
            const rData = seg.mockRoutes.find(r=>r.id===routeId);
            if(!rData) return;

            const map = new google.maps.Map(div, { zoom: 10, center: {lat:35.681, lng:139.767}, mapTypeControl:false, streetViewControl:false });
            const renderer = new google.maps.DirectionsRenderer({ map: map, suppressMarkers:false, polylineOptions:{strokeColor:'#4f46e5', strokeWeight:5} });

            // DirectionsServiceã‚’å†åº¦å‘¼ã‚“ã§æç”» (APIã®åˆ¶ç´„ä¸Šã€Responseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¿…è¦ãªãŸã‚)
            new google.maps.DirectionsService().route({
                origin: itinerary.stops[index].location, destination: itinerary.stops[index+1].location,
                travelMode: seg.travelMode, provideRouteAlternatives: true
            }, (res, status) => {
                if(status==='OK') {
                    // åå‰ãŒä¸€è‡´ã™ã‚‹ãƒ«ãƒ¼ãƒˆã‚’æ¢ã™
                    const target = res.routes.find(r => r.summary === rData.desc) || res.routes[0];
                    renderer.setDirections({routes:[target], request:res.request}); // æ­£ã—ã„å½¢å¼ã§ã‚»ãƒƒãƒˆ
                    renderer.setMap(map);
                }
            });
        }

        // ãƒ«ãƒ¼ãƒˆé¸æŠæ™‚ã®å‡¦ç†ï¼ˆåœ°å›³ãŒæ¶ˆãˆãªã„ã‚ˆã†ã«ãƒšãƒ¼ã‚¸å…¨ä½“ã§ã¯ãªãéƒ¨åˆ†æ›´æ–°ã€ã‚ã‚‹ã„ã¯å†æç”»å¾Œã«åœ°å›³ã‚’å‘¼ã¶ï¼‰
        function selectRoute(index, routeId) {
            itinerary.segments[index].selectedRoute = routeId;
            saveState();
            renderSelectionPage(); // å…¨ä½“å†æç”» (åœ°å›³ã‚‚å†åˆæœŸåŒ–ã•ã‚Œã‚‹ã®ã§æ¶ˆãˆãªã„)
        }

        function addStop() { itinerary.stops.splice(itinerary.stops.length-1,0,{id:'s'+Date.now(), location:'', stayMinutes:30, isBaseTime:false}); saveState(); renderInputPage(); }
        function removeStop(i) { itinerary.stops.splice(i,1); saveState(); renderInputPage(); }
        function setBase(i) { itinerary.stops.forEach(s=>s.isBaseTime=false); itinerary.stops[i].isBaseTime=true; saveState(); renderInputPage(); }
        function changeMode(i, m) { itinerary.segments[i].travelMode=m; saveState(); renderInputPage(); }
        function saveLoc(id) { const v=itinerary.stops.find(s=>s.id===id).location; if(v && !savedLocations.includes(v)) { savedLocations.push(v); saveState(); showAlert('ä¿å­˜ã—ã¾ã—ãŸ','success'); } }
        function goToSelection() { navigate('selection'); }
        function updateDatalist() { const l=document.getElementById('saved-locations-list'); if(l) l.innerHTML=savedLocations.map(x=>`<option value="${x}">`).join(''); }
        function clearData() { if(confirm('åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')) { localStorage.removeItem('itineraryState'); location.reload(); } }
        function showAlert(m,t) { const c=document.getElementById('message-container'); c.innerHTML=`<div class="px-4 py-2 text-white rounded shadow ${t==='error'?'bg-red-500':'bg-indigo-600'}">${m}</div>`; setTimeout(()=>c.innerHTML='',3000); }

        window.onload = function() { renderInputPage(); }
    </script>
</body>
</html>
